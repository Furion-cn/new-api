# One-API 日志轮转配置
/data/*.log {
    # 每天轮转一次
    daily
    
    # 保留7个旧日志文件
    rotate 30
    
    # 压缩旧日志文件
    compress
    
    # 延迟压缩，下次轮转时才压缩
    delaycompress
    
    # 如果日志文件不存在，不报错
    missingok
    
    # 如果日志文件为空，不轮转
    notifempty
    
    # 创建新日志文件的权限
    create 644 root root
    
    # 设置最大总大小限制为15GB
    maxsize 15G
    
    # 轮转后执行的脚本
    postrotate
        # 发送SIGHUP信号给应用，让它重新打开日志文件
        kill -HUP $(cat /var/run/one-api.pid 2>/dev/null) 2>/dev/null || true
    endscript
    
    # 轮转前执行的脚本
    prerotate
        # 可以在这里添加轮转前的操作
        echo "Starting log rotation for one-api at $(date)" >> /data/rotation.log
    endscript
}
